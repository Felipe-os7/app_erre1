{% extends 'base.html' %}
{% load static currency %}

{% block content %}
<script>
function addToCart(itemType, itemId) {
  fetch(`/contacto/cart/add/${itemType}/${itemId}/`, {
    method: 'GET',
    headers: {
      'X-Requested-With': 'XMLHttpRequest',
    },
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      alert(data.message);
      // Opcional: redirigir al carrito
      if (confirm('¿Deseas ir al carrito de cotización?')) {
        window.location.href = '{% url "contacto:contacto" %}';
      }
    } else {
      alert(data.message);
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('Error al agregar al carrito');
  });
}
</script>
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 60px; flex-wrap: wrap; gap: 24px;">
    <h1 style="margin: 0;">Galería</h1>
    {% if user.is_authenticated %}
      <a href="{% url 'galeria:submit_art' %}" class="btn btn-primary" style="text-decoration: none; display: inline-block;">Enviar Obra</a>
    {% endif %}
  </div>
<<<<<<< HEAD
=======
  
>>>>>>> 6e651caf3fa992905a00e5b8a2c3021e6f4c7ce3

  <h2 style="margin-top: 60px;">Pinturas e Ilustraciones</h2>
  <form method="get" class="filters" style="display: flex; align-items: center; justify-content: space-between; gap: 20px; margin-bottom: 30px; width: 100%;">
    <div style="display: flex; align-items: center; gap: 8px;">
      <label for="category">Categoría:</label>
      <select name="category" id="category">
        <option value="">Todas</option>
        <option value="pintura" {% if request.GET.category == 'pintura' %}selected{% endif %}>Pinturas</option>
        <option value="ilustracion" {% if request.GET.category == 'ilustracion' %}selected{% endif %}>Ilustraciones</option>
      </select>
    </div>

    <div style="display: flex; align-items: center; gap: 8px;">
      <label for="for_sale">En venta:</label>
      <select name="for_sale" id="for_sale">
        <option value="">Todos</option>
        <option value="1" {% if request.GET.for_sale == '1' %}selected{% endif %}>Sí</option>
        <option value="0" {% if request.GET.for_sale == '0' %}selected{% endif %}>No</option>
      </select>
    </div>

    <button type="submit">Filtrar</button>
  </form>
  <div class="grid">
    {% for p in paintings %}
      <article class="card">
        {% if p.image %}
          <a class="lightbox" href="{{ p.image.url }}"><img src="{{ p.image.url }}" alt="{{ p.title }}"></a>
        {% else %}
          <img src="{% static 'img/placeholder.png' %}" alt="{{ p.title }}">
        {% endif %}
        <div class="card-content">
          <h3>{{ p.title }}</h3>
          {% if p.description %}<p class="meta">{{ p.description }}</p>{% endif %}
          <p class="meta">{% if p.category %}{{ p.get_category_display }} • {% endif %}{% if p.technique %}Técnica: {{ p.technique }} • {% endif %}{% if p.year %}Año: {{ p.year }}{% endif %}</p>
          {% if p.price %}
            <p class="price">{{ p.price|clp }}</p>
          {% endif %}
          <p class="meta">{% if p.is_for_sale %}<strong style="color: var(--mustard-dark);">En venta</strong>{% else %}No en venta{% endif %}</p>
          {% if p.is_for_sale %}
            <button onclick="addToCart('painting', {{ p.id }})" class="btn btn-primary" style="margin-top: 12px; width: 100%; padding: 10px; font-size: 14px; cursor: pointer;">
              Agregar a Cotización
            </button>
          {% endif %}
          {% if user.is_authenticated %}
            <form method="post" action="{% url 'galeria:delete_painting' p.id %}" style="margin-top: 8px;" onsubmit="return confirm('¿Estás seguro de que deseas eliminar esta pintura?');">
              {% csrf_token %}
              <button type="submit" class="btn" style="width: 100%; padding: 8px; font-size: 12px; cursor: pointer; background-color: #dc3545; color: white; border: none;">
                Eliminar
              </button>
            </form>
          {% endif %}
        </div>
      </article>
    {% empty %}
      <p>No hay pinturas.</p>
    {% endfor %}
  </div>

  {% if paintings.has_other_pages %}
    <nav class="pagination">
      {% if paintings.has_previous %}
        <a href="?page={{ paintings.previous_page_number }}{% if request.GET.collection %}&collection={{ request.GET.collection }}{% endif %}{% if request.GET.for_sale %}&for_sale={{ request.GET.for_sale }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}">Anterior</a>
      {% endif %}
      <span>Página {{ paintings.number }} de {{ paintings.paginator.num_pages }}</span>
      {% if paintings.has_next %}
        <a href="?page={{ paintings.next_page_number }}{% if request.GET.collection %}&collection={{ request.GET.collection }}{% endif %}{% if request.GET.for_sale %}&for_sale={{ request.GET.for_sale }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}">Siguiente</a>
      {% endif %}
    </nav>
  {% endif %}

{% endblock %}
